"use strict";(self["webpackChunkSimple_Web_based_Interface_for_Scanner"]=self["webpackChunkSimple_Web_based_Interface_for_Scanner"]||[]).push([[67],{6067:(e,t,o)=>{o.r(t),o.d(t,{default:()=>R});var n=o(3673),i=o(2323),a=o(8880);const l={key:0,style:{position:"absolute",left:"40%"}},s=(0,n._)("h4",null,"Set the parameters and start scanning",-1),r=(0,n.Uk)("Start scanning"),c={key:2},m={class:"row justify-center q-mt-lg"},d={style:{position:"relative"}},p=["src"],u={class:"row justify-center"},g={class:"q-mr-md q-mb-md"},h=["href"],f=(0,n.Uk)(" Download "),y={class:"text-center q-ml-md q-mb-md"},_=(0,n._)("div",{style:{"font-size":"1.5rem"}},"Set aspect ratio",-1);function v(e,t,o,v,b,w){const q=(0,n.up)("q-circular-progress"),x=(0,n.up)("q-select"),k=(0,n.up)("q-btn"),S=(0,n.up)("q-form"),$=(0,n.up)("q-icon"),C=(0,n.up)("q-page");return(0,n.wg)(),(0,n.j4)(C,{class:"col text-center"},{default:(0,n.w5)((()=>[e.inProgress?((0,n.wg)(),(0,n.iD)("div",l,[(0,n.Wm)(q,{indeterminate:"",size:"100pt",thickness:.6,color:"lime","center-color":"grey-8",class:"q-ma-md"},null,8,["thickness"])])):(0,n.kq)("",!0),void 0==e.filename?((0,n.wg)(),(0,n.iD)("div",{key:1,style:(0,i.j5)({opacity:e.inProgress?.5:1})},[s,(0,n.Wm)(S,{onSubmit:(0,a.iM)(e.startScan,["prevent"]),class:"q-mx-lg q-mt-lg"},{default:(0,n.w5)((()=>[(0,n.Wm)(x,{modelValue:e.format,"onUpdate:modelValue":t[0]||(t[0]=t=>e.format=t),options:e.formatOptions,label:"Output type",outlined:"",class:"q-mx-md q-my-xs"},null,8,["modelValue","options"]),(0,n.Wm)(x,{modelValue:e.resolution,"onUpdate:modelValue":t[1]||(t[1]=t=>e.resolution=t),options:e.resolutionOptions,label:"Resolution (dpi)",outlined:"",class:"q-mx-md q-my-xs"},null,8,["modelValue","options"]),(0,n.Wm)(x,{modelValue:e.mode,"onUpdate:modelValue":t[2]||(t[2]=t=>e.mode=t),options:e.modeOptions,label:"Mode",outlined:"",class:"q-mx-md q-my-xs"},null,8,["modelValue","options"]),(0,n.Wm)(k,{color:"green",class:(0,i.C_)({"q-mt-md":e.$q.screen.gt.xs}),style:{"font-size":"1.5rem"},type:"submit",icon:"scanner"},{default:(0,n.w5)((()=>[r])),_:1},8,["class"])])),_:1},8,["onSubmit"])],4)):(0,n.kq)("",!0),void 0!=e.filename?((0,n.wg)(),(0,n.iD)("div",c,[(0,n._)("div",m,[(0,n._)("div",d,[(0,n._)("img",{ref:"img",src:e.image_url,style:{"max-height":"500px"},crossorigin:"anonymous"},null,8,p)])]),(0,n._)("div",u,[(0,n._)("div",g,[(0,n._)("div",null,[(0,n._)("a",{href:e.image_url,class:"q-my-md",style:{border:"1pt solid black","border-radius":"20pt","font-size":"22pt",padding:"8pt","text-decoration":"none"},download:""},[(0,n.Wm)($,{name:"download"}),f],8,h)]),(0,n._)("div",null,"Filename: "+(0,i.zw)(e.filename),1)]),(0,n._)("div",y,[_,(0,n._)("div",null,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.aspectRatios,(t=>((0,n.wg)(),(0,n.j4)(k,{key:t.label,label:t.label,onClick:o=>e.changeAspectRatio(t.x,t.y),class:"q-mx-xs"},null,8,["label","onClick"])))),128))]),e.cropper?((0,n.wg)(),(0,n.j4)(k,{key:0,class:"q-my-lg",label:"crop & save",onClick:e.crop},null,8,["onClick"])):(0,n.kq)("",!0)])])])):(0,n.kq)("",!0)])),_:1})}o(2100),o(812),o(979),o(6105),o(5123),o(8685),o(2396);var b=o(1254),w=o.n(b);const q=(0,n.aZ)({name:"PageScan",data:function(){return{config:void 0,cropper:void 0,filename:void 0,aspectRatios:[{label:"1:1",x:1,y:1},{label:"2:3",x:2,y:3},{label:"4:3",x:4,y:3},{label:"16:9",x:16,y:9},{label:"A4",x:210,y:297}],format:void 0,formatOptions:["png","jpg"],resolution:void 0,resolutionOptions:["75","100","150","200","250","300","600"],mode:void 0,modeOptions:["color","gray"],inProgress:!1}},computed:{image_url:function(){return`http://${this.config.api_url}:${this.config.api_port}${this.config.scans_url}/${this.filename}`},scan_url:function(){return`http://${this.config.api_url}:${this.config.api_port}/scan/execute`},image_update_url:function(){return`http://${this.config.api_url}:${this.config.api_port}/scan/update`}},watch:{resolution:function(e){localStorage.setItem("resolution",e)},format:function(e){localStorage.setItem("format",e)},mode:function(e){localStorage.setItem("mode",e)}},created(){var e,t,o;this.resolution=null!==(e=localStorage.getItem("resolution"))&&void 0!==e?e:"150",this.format=null!==(t=localStorage.getItem("format"))&&void 0!==t?t:"png",this.mode=null!==(o=localStorage.getItem("mode"))&&void 0!==o?o:"color",this.randVal=Math.random()},mounted(){this.getJSON("config","config.json").then((e=>{this.config=e}))},methods:{getJSON:function(e,t){return new Promise(((o,n)=>{this.$axios.get(t).then((t=>{let n=t.data;localStorage.setItem(e,JSON.stringify(n)),o(n)})).catch((e=>{console.log(e),n(e)}))}))},startScan:function(){this.inProgress=!0,this.$axios.post(this.scan_url,{format:`${this.format}`,resolution:`${this.resolution}`,mode:`${this.mode}`}).then((e=>{console.log(e),0==e.data.code&&(this.filename=e.data.filename),this.inProgress=!1})).catch((e=>{this.inProgress=!1}))},createCropper:function(){this.cropper=new(w())(this.$refs.img,{viewMode:2,crop(e){}})},getTypeFromFilename:function(e){let t=e.split(".").pop().toLowerCase();if("png"==t)return"png";if(["jpg","jpeg"].includes(t))return"jpeg";throw"Unsupported filetype."},changeAspectRatio:function(e,t){void 0==this.cropper&&this.createCropper(),this.cropper.setAspectRatio(e/t)},dataURLtoFile:function(e,t){const o=e.split(","),n=o[0].match(/:(.*?);/)[1],i=atob(o[1]);let a=i.length;const l=new Uint8Array(a);while(a)l[a-1]=i.charCodeAt(a-1),a-=1;return new File([l],t,{type:n})},reloadImage:function(e){},downloadImage:function(){var e=document.createElement("a");e.setAttribute("href",this.getImageData()),e.setAttribute("download",this.filename),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)},getImageData:function(){if(void 0==this.cropper){const e=document.createElement("canvas");return e.width=this.$refs.img.width,e.height=this.$refs.img.height,e.getContext("2d").drawImage(this.$refs.img,0,0),e.toDataURL()}return this.cropper.getCroppedCanvas().toDataURL(`image/${this.getTypeFromFilename(this.filename)}`)},crop:function(){let e=this.cropper.getCroppedCanvas().toDataURL(`image/${this.getTypeFromFilename(this.filename)}`);const t=this.dataURLtoFile(e,this.filename);var o=new FormData;o.append("file",t,t.name),this.$axios.post(this.image_update_url,o,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{console.log("done"),console.log(e),this.reloadImage()})).catch((e=>{console.log("problem"),console.log(e)}))}}});var x=o(4260),k=o(4379),S=o(6122),$=o(5269),C=o(7137),I=o(4607),F=o(4554),U=o(7518),j=o.n(U);const D=(0,x.Z)(q,[["render",v]]),R=D;j()(q,"components",{QPage:k.Z,QCircularProgress:S.Z,QForm:$.Z,QSelect:C.Z,QBtn:I.Z,QIcon:F.Z})}}]);